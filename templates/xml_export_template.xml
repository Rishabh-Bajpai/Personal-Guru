<?xml version="1.0" encoding="UTF-8"?>
<study_plan>
    <topic>{{ topic.name }}</topic>
    <average_score>{{ average_score }}</average_score>
    <steps>
        {% for step in topic.steps %}
        <step>
            <title>{{ topic.plan[loop.index0] }}</title>
            <content><![CDATA[{{ step.teaching_material | safe }}]]></content>
            {% if step.questions %}
            <questions>
                {% for question in step.questions.questions %}
                <question>
                    <text>{{ question.question }}</text>
                    <options>
                        {% for option in question.options %}
                        <option>{{ option }}</option>
                        {% endfor %}
                    </options>
                    <correct_answer>{{ question.correct_answer }}</correct_answer>
                    {% if step.user_answers %}
                    <user_answer>{{ step.user_answers[loop.index0] }}</user_answer>
                    {% endif %}
                </question>
                {% endfor %}
            </questions>
            {% endif %}
        </step>
        {% endfor %}
    </steps>
</study_plan>
