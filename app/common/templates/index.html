{% extends "base.html" %}

{% block title %}Personalized Learning App{% endblock %}

{% block content %}
<h1>What would you like to learn today?</h1>
<form method="post" onsubmit="showLoader()">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <input type="text" name="topic" size="50" placeholder="Enter a new topic..." required>
    {% if error %}
    <p class="error error-text">{{ error }}</p>
    {% endif %}
    <div class="learning-modes">
        <p>Choose a learning mode:</p>
        <label>
            <input type="radio" name="mode" value="chapter" checked> Chapter Mode
        </label>
        <label>
            <input type="radio" name="mode" value="chat"> Chat Mode
        </label>
        <label>
            <input type="radio" name="mode" value="quiz"> Quiz Mode
        </label>
        <label>
            <input type="radio" name="mode" value="reel"> Reel Mode
        </label>
        <label>
            <input type="radio" name="mode" value="flashcard"> Flash Card Mode
        </label>
    </div>
    <input type="submit" value="Start Learning" class="button">
</form>

<h2>Your Saved Topics</h2>
{% if topics %}
<div class="topics-list">
    <ul>
        {% for topic in topics %}
        <li>
            <span class="topic-name"><strong>{{ topic.name }}</strong></span>
            
            <div class="mode-buttons">
                <!-- Chapter Mode -->
                <a href="{{ url_for('chapter.learn_topic', topic_name=topic.name, step_index=0) }}" 
                   class="button {% if not topic.has_plan %}secondary{% endif %}">
                   Chapter
                </a>
        
                <!-- Chat Mode -->
                <a href="{{ url_for('chat.mode', topic_name=topic.name) }}" 
                   class="button {% if not topic.has_chat %}secondary{% endif %}">
                   Chat
                </a>
                
                <!-- Quiz Mode -->
                <a href="{{ url_for('quiz.mode', topic_name=topic.name) }}" 
                   class="button {% if not topic.has_quiz %}secondary{% endif %}">
                   Quiz
                </a>

                <!-- Flashcard Mode -->
                <a href="{{ url_for('flashcard.mode', topic_name=topic.name) }}" 
                   class="button {% if not topic.has_flashcards %}secondary{% endif %}">
                   Flashcard
                </a>

                <!-- Reel Mode -->
                <a href="{{ url_for('reel.mode', topic_name=topic.name) }}" 
                   class="button {% if not topic.has_reels %}secondary{% endif %}">
                   Reel
                </a>
            </div>

            <a href="{{ url_for('main.delete_topic_route', topic_name=topic.name) }}"
                class="button delete-button">Delete</a>
        </li>
        {% endfor %}
    </ul>
    
    <style>
        .mode-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap; /* Prevent overflow on small screens */
            margin: 0 20px;
        }
        .topic-name {
            flex-shrink: 0; /* Ensure name doesn't collapse */
            font-size: 1.1em;
            width: 150px; /* Fixed width for alignment, or remove for fluid */
        }
        @media (max-width: 768px) {
            .topics-list li {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .mode-buttons {
                margin: 0;
            }
        }
    </style>
</div>
{% else %}
<p>You don't have any saved topics yet.</p>
{% endif %}
{% endblock %}