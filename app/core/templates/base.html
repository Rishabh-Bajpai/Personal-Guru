<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}Personalized Learning App{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    {% block head %}{% endblock %}
    <!-- Allow child templates to inject custom styles (e.g., Chat mode) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    {% block styles %}{% endblock %}
</head>

<body class="dark-mode">
    <div id="loader">
        <div class="spinner"></div>
    </div>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">
                <a href="/">
                    <img src="{{ url_for('static', filename='img/PG.svg') }}" alt="PG Logo" class="brand-logo">
                    <span class="brand-text">Personal Guru</span>
                </a>
            </div>

            <div class="nav-menu">
                <a href="/" class="nav-link icon-link" title="Home">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="https://samosa-ai.com/personal-guru/docs" target="_blank" class="nav-link icon-link"
                    title="Documentation">
                    <i class="fas fa-book"></i> Docs
                </a>
                <a href="https://github.com/Rishabh-Bajpai/Personal-Guru" target="_blank" class="nav-link icon-link"
                    title="GitHub">
                    <i class="fab fa-github"></i> GitHub
                </a>
                <a href="https://samosa-ai.com/" target="_blank" class="nav-link icon-link" title="Samosa AI">
                    <img src="{{ url_for('static', filename='img/samosa_logo.png') }}" alt="Samosa"
                        class="nav-icon-img"> Samosa
                </a>
            </div>

            <div class="nav-actions">
                <button id="theme-switcher" class="nav-link icon-only" title="Toggle Theme">ğŸŒ“</button>
                <button id="feedback-btn" class="nav-link icon-link">ğŸ“ Feedback</button>

                {% if current_user.is_authenticated %}
                <div class="dropdown">
                    <button class="nav-link dropdown-toggle" title="Profile">
                        <i class="fas fa-user-circle"></i> Profile
                    </button>
                    <div class="dropdown-content">
                        <div class="dropdown-header">Hello, {{ current_user.display_name }}</div>
                        <a href="{{ url_for('main.user_profile') }}" class="dropdown-item">
                            <i class="fas fa-user-edit"></i> Edit Profile
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="{{ url_for('main.logout') }}" class="dropdown-item text-danger">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
                {% else %}
                <a href="{{ url_for('main.login') }}"
                    class="nav-link {% if request.endpoint == 'main.signup' %}highlight-btn{% endif %}">Log In</a>
                <a href="{{ url_for('main.signup') }}"
                    class="nav-link {% if request.endpoint == 'main.login' or request.endpoint != 'main.signup' %}highlight-btn{% endif %}">Sign
                    Up</a>
                {% endif %}
            </div>
        </nav>
        {% block content %}{% endblock %}
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="feedback-modal-overlay">
        <div class="feedback-modal">
            <button class="feedback-modal-close" id="feedback-close">&times;</button>
            <h2>Share Your Feedback</h2>
            <form id="feedback-form">
                <div class="feedback-form-group">
                    <label for="feedback-type">Feedback Type</label>
                    <select id="feedback-type" name="feedback_type" required>
                        <option value="">Select type...</option>
                        <option value="bug_report">ğŸ› Bug Report</option>
                        <option value="feature_request">ğŸ’¡ Feature Request</option>
                        <option value="general_feedback">ğŸ’¬ General Feedback</option>
                        <option value="content_issue">ğŸ“š Content Issue</option>
                    </select>
                </div>
                <div class="feedback-form-group">
                    <label>Rating</label>
                    <div class="star-rating" id="star-rating">
                        <span class="star" data-value="1">â˜…</span>
                        <span class="star" data-value="2">â˜…</span>
                        <span class="star" data-value="3">â˜…</span>
                        <span class="star" data-value="4">â˜…</span>
                        <span class="star" data-value="5">â˜…</span>
                    </div>
                    <input type="hidden" id="feedback-rating" name="rating" value="0">
                </div>
                <div class="feedback-form-group">
                    <label for="feedback-comment">Your Comments</label>
                    <textarea id="feedback-comment" name="comment" rows="4" placeholder="Tell us what's on your mind..."
                        required></textarea>
                </div>
                <div class="feedback-form-actions">
                    <button type="submit" class="button">Submit Feedback</button>
                    <button type="button" class="button secondary" id="feedback-cancel">Cancel</button>
                </div>
                <p id="feedback-message" class="feedback-message"></p>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='base.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>

</html>