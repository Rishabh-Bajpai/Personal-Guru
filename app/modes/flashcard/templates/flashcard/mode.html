{% extends "base.html" %}

{% block title %}Flash Card Mode{% endblock %}

{% block content %}
<h1>Flash Card Mode</h1>

<div class="flashcard-controls generation-bar" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
    <span style="font-weight: bold;">Generate:</span>
    <button class="button preset-btn" data-count="auto">Auto</button>
    <button class="button preset-btn" data-count="10">10</button>
    <button class="button preset-btn" data-count="25">25</button>

    <div class="custom-control" style="display: flex; gap: 5px; align-items: center;">
        <input type="number" id="custom-flashcount" placeholder="#" min="1" max="100"
            style="width: 70px; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
        <button id="generate-custom-btn" class="button">Go</button>
    </div>
</div>

<link rel="stylesheet" href="{{ url_for('flashcard.static', filename='flashcards.css') }}">
<div id="flashcard-container" class="flashcard-container" style="display:none;">
    <div id="flashcard" class="flashcard">
        <div class="flashcard-front">
            <h2 id="flash-term"></h2>
        </div>
        <div class="flashcard-back">
            <p id="flash-definition"></p>
        </div>
    </div>
    <div class="flashcard-nav">
        <button id="prev-card" class="button small">Previous</button>
        <button id="next-card" class="button small">Next</button>
    </div>
    <p id="flash-index"></p>
    <div id="export-controls" class="export-controls">
        <p><strong>You've reached the end of the flashcards!</strong></p>
        <a id="export-pdf-btn" href="#" class="button">Save as PDF</a>
    </div>
</div>

<div id="flash-error" class="flash-error"></div>
{% endblock %}

{% block scripts %}

<div id="flashcard-data" data-flashcards='{{ flashcards|tojson|safe }}' data-topic="{{ topic_name }}">
</div>

<script src="{{ url_for('flashcard.static', filename='mode.js') }}"></script>
<script src="{{ url_for('common.static', filename='js/time_tracker.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Flashcard mode has a special endpoint for detailed updates, 
        // but we also want generic page time tracking? 
        // The user requirement is 'count as soon as user gets out of that mode'.
        // The generic time tracker does exactly that.
        // However, flashcard route uses /update_progress which takes JSON body.
        // TimeTracker sends FormData by default to separate /update_time endpoints.
        // We haven't created a /update_time for flashcard_bp yet.
        // Wait, I see I missed adding /update_time to flashcard routes in the previous step.
        // I should add it now.

        new TimeTracker({
            // I need to add this route to flashcard/routes.py first
            updateUrl: "{{ url_for('flashcard.update_time', topic_name=topic_name) }}",
            topicName: "{{ topic_name }}"
        });
    });
</script>
<script>
    initFlashcardMode({
        urls: {
            generate: "{{ url_for('flashcard.generate_flashcards_route') }}",
            export_pdf: "{{ url_for('flashcard.export_pdf', topic_name=topic_name) }}"
        }
    });
</script>

{% endblock %}